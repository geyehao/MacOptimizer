# Mac优化大师 v4.0.2 更新日志

**发布日期**：2026-01-10

---

## 🔒 安全与稳定性增强

### 修复：应用启动崩溃问题
- **问题**：在某些情况下，应用启动时会立即崩溃
- **原因**：`MenuBarManager` 在应用完全初始化之前尝试创建系统状态栏图标
- **解决**：使用延迟初始化确保系统资源就绪后再创建状态栏

### 修复：无网络环境下启动崩溃
- **问题**：当用户没有网络连接或使用代理时，应用启动会闪退
- **原因**：启动时的更新检查在网络异常情况下导致崩溃
- **解决**：
  - 添加 `NWPathMonitor` 检测网络状态
  - 无网络时自动跳过更新检查
  - 优化超时时间，避免长时间等待

---

## 🛡️ 智能清理安全升级

### 新增：已安装应用保护机制
- **问题**：之前版本可能误删已安装应用的关键数据（如微信聊天记录、Edge配置）
- **解决**：
  - 增强 `SafetyGuard` 保护已安装应用的 `Containers` 目录
  - 保护 `Application Support` 中的已安装应用数据
  - 只允许清理安全的缓存子目录（`Caches`、`tmp`、`Logs`）

### 新增：删除日志服务
- 新增 `DeletionLogService` 服务
- 所有删除操作自动记录原始路径
- 支持从废纸篓恢复文件到原位置
- 日志保存 30 天，自动清理过期记录

---

## 📁 受影响文件

| 文件 | 变更类型 | 说明 |
|------|---------|------|
| `DeletionLogService.swift` | 新增 | 删除日志与恢复服务 |
| `SafetyGuard.swift` | 修改 | 增加已安装应用保护 |
| `SmartCleanerService.swift` | 修改 | 使用安全删除服务 |
| `FileRemover.swift` | 修改 | 使用安全删除服务 |
| `JunkCleaner.swift` | 修改 | 使用安全删除服务 |
| `MenuBarManager.swift` | 修改 | 延迟初始化修复启动崩溃 |
| `UpdateCheckerService.swift` | 修改 | 网络检测修复无网络崩溃 |

---

## 🔄 升级建议

建议所有用户升级到 v4.0.2 版本，特别是：
- 曾遇到应用启动闪退的用户
- 使用代理或网络环境不稳定的用户
- 担心智能清理误删应用数据的用户
